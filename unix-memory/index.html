<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>Typed Chronicles</title>

    <!-- CSS -->
    <!-- <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" /> -->
    <link rel="shortcut icon" href="/favicon.ico" />
    <!-- <link rel="stylesheet" href="https://vincenthz.github.io/print.css" media="print"> -->
    <!-- <link rel="stylesheet" href="https://vincenthz.github.io/normalize.css"> -->
    <link rel="stylesheet" href="https://vincenthz.github.io/typed.css">

    

    

    

    

    <script>function toggle_darkmode() { document.querySelector('body').classList.toggle('dark') }
    </script>

    
    
</head>

<body>
    <div id="page-outer">

        <div id="page">
            
<header>
  <h1>Typed Chronicles</h1>
<p class="lead">Vincent Hanquez's adventures</p>
<!-- <a href="https:&#x2F;&#x2F;vincenthz.github.io">Typed Chronicles</a> -->
<nav id="nav-site">
    <ul>
        <li><a class="icon" href="https:&#x2F;&#x2F;vincenthz.github.io"><img src="/icons/home.svg"></a> </li>
        <li><a class="icon" href="https://vincenthz.github.io/rss.xml"><img src="/icons/rss.svg"></a>
        </li>
        <li><a class="icon" href="https://github.com/vincenthz" target="_blank"><img src="/icons/gh.svg"></a></li>
        <li><a class="icon" href="https://twitter.com/vincenthz" target="_blank"><img src="/icons/tw.svg"></a></li>
    </ul>
</nav>

</header>


            <main>
                
<h1 class="page-title">unix memory</h1>
<span class="post-date">Published on 2014-02-25</span>
<p>On unix system, we get access to syscalls that maps files or devices into
memory. The main syscall is mmap, but there's also some others syscalls in the
same family to handle mapped memories like mlock, munlock, mprotect, madvise,
msync.</p>
<span id="continue-reading"></span>
<p>Some limited mmap access is available through the
<a href="http://hackage.haskell.org/package/mmap">mmap</a> or
<a href="http://hackage.haskell.org/package/bytestring-mmap">bytestring-mmap</a> packages,
but both provide a high level access to those API.</p>
<p>To the rescue, I've released
<a href="http://hackage.haskell.org/package/unix-memory">unix-memory</a>.  This provide
low level access to all those syscalls. In some place, the API presented is
slightly better than the raw API.</p>
<p>This package is supposed to be ephemeral; The goal is to fold this package to
the venerable <a href="http://hackage.haskell.org/package/unix">unix</a> package when this
becomes less experimental, more stable and is known to work on different
unixoid platforms.  If and when this happens, then this package will just
provide compatibility for old versions and eventually be deprecated.</p>
<p>Manipulating memory is unsafe in general, so don't expect any safety from this
package, by design. Also if you don't know what you're doing, don't use those
APIs; It's difficult to get right.</p>
<p>But it also allow interesting patterns when you cooperate with the operating system
to efficiently map files, and devices as virtual memory.</p>
<p>A simple example opening the &quot;/dev/zero&quot; device first memory page, and reading 4096 bytes from it:</p>
<pre data-linenos data-lang="haskell" style="background-color:#2b303b;color:#c0c5ce;" class="language-haskell "><code class="language-haskell" data-lang="haskell"><table><tbody><tr><td>1</td><td><span style="color:#b48ead;">import </span><span>System.Posix.IO
</span><tr><td>2</td><td><span style="color:#b48ead;">import </span><span>System.Posix.Memory
</span><tr><td>3</td><td><span style="color:#b48ead;">import </span><span>Control.Monad
</span><tr><td>4</td><td><span style="color:#b48ead;">import </span><span>Control.Exception (</span><span style="color:#8fa1b3;">bracket</span><span>)
</span><tr><td>5</td><td><span style="color:#b48ead;">import </span><span>Foreign.C.Types
</span><tr><td>6</td><td><span style="color:#b48ead;">import </span><span>Foreign.Storable
</span><tr><td>7</td><td><span>
</span><tr><td>8</td><td><span>bracket (openFd &quot;</span><span style="color:#a3be8c;">/dev/zero</span><span>&quot; </span><span style="color:#d08770;">ReadWrite Nothing</span><span> defaultFileFlags) closeFd $ \fd -&gt;
</span><tr><td>9</td><td><span>  bracket (memoryMap </span><span style="color:#d08770;">Nothing 4096</span><span> [</span><span style="color:#d08770;">MemoryProtectionRead</span><span>] </span><span style="color:#d08770;">MemoryMapPrivate</span><span> (</span><span style="color:#d08770;">Just</span><span> fd) </span><span style="color:#d08770;">0</span><span>)
</span><tr><td>10</td><td><span>          (\mem -&gt; memoryUnmap mem </span><span style="color:#d08770;">4096</span><span>)
</span><tr><td>11</td><td><span>          (\mem -&gt; mapM (peekElemOff mem) [</span><span style="color:#d08770;">0</span><span>..</span><span style="color:#d08770;">4095</span><span>])
</span></tr></tbody></table></code></pre>


            </main>
        </div>

        <footer>
            <div class="inner">
                <div class="about-short">
                    <h2><a href="/about/">About me</a></h2>
                    <p>I've been developping software for the last 20 years, in many different languages and many
                        different projects.
                        My main interests are currently cryptography, security and typed programming</p>
                    <p>I'm the director of <a href="https://typed.io/">Typed IO</a>, a software contracting company</p>
                </div>
                <div class="social">
                    <a class="icon" href="https://github.com/vincenthz" target="_blank"><img src="/icons/gh.svg"></a>
                    <a class="icon" href="https://twitter.com/vincenthz" target="_blank"><img src="/icons/tw.svg"></a>
                    <a class="icon" href="https://vincenthz.github.io/rss.xml"><img src="/icons/rss.svg"></a>
                </div>
                <span>&copy; 2014-2021 Vincent Hanquez</span>
            </div>
        </footer>
    </div>

</body>


</html>
